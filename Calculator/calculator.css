/* ══════ Theme Variables ══════ */
:root {
    --bg-grad: linear-gradient(135deg, #1a0533 0%, #0d1b5e 35%, #0a3d3d 70%, #1a0533 100%);
    --orb1: rgba(255,80,180,0.15); --orb2: rgba(80,200,255,0.12);
    --phone-bg: #0d0d0f; --phone-border: #3a3a40; --phone-border2: #1c1c20; --side-btn: #2a2a2e;
    --screen-bg: #000; --calc-bg: #000;
    --text-1: #fff; --text-2: rgba(255,255,255,0.3); --text-3: rgba(255,255,255,0.42); --text-4: rgba(255,255,255,0.4);
    --surface-1: rgba(255,255,255,0.07); --surface-2: rgba(255,255,255,0.13); --surface-3: rgba(255,255,255,0.1);
    --surface-4: rgba(255,255,255,0.05); --surface-5: rgba(255,255,255,0.08);
    --btn-num-bg: #1c1c1e; --btn-num-c: #fff;
    --btn-fn-bg: rgba(255,255,255,0.14); --btn-fn-c: #fff;
    --sheet-bg: #1c1c1e; --handle: rgba(255,255,255,0.18);
    --sep: rgba(255,255,255,0.07); --scrollbar-c: rgba(255,255,255,0.12);
    --overlay-bg: rgba(0,0,0,0.5);
}
[data-theme="light"] {
    --bg-grad: linear-gradient(135deg, #e8dff5 0%, #d0dff5 35%, #d0efef 70%, #e8dff5 100%);
    --orb1: rgba(255,80,180,0.06); --orb2: rgba(80,200,255,0.06);
    --phone-bg: #d1d1d6; --phone-border: #b0b0b5; --phone-border2: #c7c7cc; --side-btn: #b5b5ba;
    --screen-bg: #f2f2f7; --calc-bg: #f2f2f7;
    --text-1: #000; --text-2: rgba(0,0,0,0.35); --text-3: rgba(0,0,0,0.45); --text-4: rgba(0,0,0,0.4);
    --surface-1: rgba(0,0,0,0.06); --surface-2: rgba(0,0,0,0.1); --surface-3: rgba(0,0,0,0.07);
    --surface-4: rgba(0,0,0,0.04); --surface-5: rgba(0,0,0,0.06);
    --btn-num-bg: #fff; --btn-num-c: #1c1c1e;
    --btn-fn-bg: #d4d4d2; --btn-fn-c: #1c1c1e;
    --sheet-bg: #fff; --handle: rgba(0,0,0,0.15);
    --sep: rgba(0,0,0,0.08); --scrollbar-c: rgba(0,0,0,0.1);
    --overlay-bg: rgba(0,0,0,0.3);
}

/* ══════ Reset & Body ══════ */
*,*::before,*::after { box-sizing:border-box; margin:0; padding:0; }
body {
    font-family:'DM Sans',sans-serif; min-height:100vh;
    display:flex; align-items:center; justify-content:center;
    background:var(--bg-grad); overflow:hidden;
}
body::before {
    content:''; position:fixed; width:600px; height:600px; border-radius:50%;
    background:radial-gradient(circle,var(--orb1),transparent 70%);
    top:-100px; left:-100px; animation:orb1 8s ease-in-out infinite alternate; pointer-events:none;
}
body::after {
    content:''; position:fixed; width:500px; height:500px; border-radius:50%;
    background:radial-gradient(circle,var(--orb2),transparent 70%);
    bottom:-100px; right:-100px; animation:orb2 10s ease-in-out infinite alternate; pointer-events:none;
}
@keyframes orb1 { to { transform:translate(80px,60px) scale(1.1); } }
@keyframes orb2 { to { transform:translate(-60px,-80px) scale(1.15); } }

/* ══════ iPhone Shell ══════ */
.iphone {
    position:relative; width:390px; background:var(--phone-bg); border-radius:54px; padding:14px;
    box-shadow: 0 0 0 1px var(--phone-border), 0 0 0 3px var(--phone-border2),
                0 0 0 4px var(--phone-border), 0 50px 100px rgba(0,0,0,0.8),
                inset 0 1px 0 rgba(255,255,255,0.1);
    animation:phoneIn .7s cubic-bezier(.34,1.56,.64,1) both;
}
@keyframes phoneIn { from { opacity:0; transform:scale(.8) translateY(40px); } to { opacity:1; transform:scale(1) translateY(0); } }
.iphone::before {
    content:''; position:absolute; right:-4px; top:140px; width:4px; height:80px;
    background:var(--side-btn); border-radius:0 3px 3px 0;
}
.iphone::after {
    content:''; position:absolute; left:-4px; top:110px; width:4px; height:40px;
    background:var(--side-btn); border-radius:3px 0 0 3px;
    box-shadow:0 55px 0 var(--side-btn), 0 105px 0 var(--side-btn);
}
.screen { background:var(--screen-bg); border-radius:42px; overflow:hidden; position:relative; }

/* ══════ Dynamic Island & Status Bar ══════ */
.island {
    position:absolute; top:12px; left:50%; transform:translateX(-50%);
    width:120px; height:34px; background:#000; border-radius:20px; z-index:10;
    box-shadow:0 0 0 2px #1a1a1a; display:flex; align-items:center; justify-content:center; gap:14px;
}
.island-cam { width:12px; height:12px; border-radius:50%; background:#0a0a0a; border:2px solid #1a1a1a; box-shadow:inset 0 0 3px rgba(100,180,255,0.3); }
.island-dot { width:6px; height:6px; border-radius:50%; background:#111; border:1px solid #222; }
.status-bar { display:flex; justify-content:space-between; align-items:center; padding:14px 28px 0; height:56px; color:var(--text-1); }
.status-time { font-size:15px; font-weight:700; letter-spacing:-0.3px; }
.status-icons { display:flex; gap:6px; align-items:center; }
.status-icons svg { fill:var(--text-1); }

/* ══════ App Topbar ══════ */
.app-topbar { display:flex; justify-content:space-between; align-items:center; padding:6px 20px 0; }
.app-title { font-size:12px; font-weight:600; color:var(--text-2); letter-spacing:1.5px; text-transform:uppercase; }
.topbar-actions { display:flex; gap:6px; }
.icon-btn {
    width:28px; height:28px; background:var(--surface-3); border:1.5px solid var(--sep);
    border-radius:50%; color:var(--text-3); font-size:14px; font-weight:600; cursor:pointer;
    display:flex; align-items:center; justify-content:center; transition:all .2s;
    font-family:'DM Sans',sans-serif; line-height:1;
}
.icon-btn:hover { background:var(--surface-2); color:var(--text-1); transform:scale(1.1); }
.icon-btn:active { transform:scale(.92); }
.icon-btn svg { width:13px; height:13px; fill:none; stroke:currentColor; stroke-width:2; stroke-linecap:round; stroke-linejoin:round; }

/* ══════ Calc Body ══════ */
.calc-body { padding:0 16px 28px; background:var(--calc-bg); display:flex; flex-direction:column; }

/* Mode selector */
.mode-selector { display:flex; background:var(--surface-1); border-radius:12px; padding:3px; margin-bottom:8px; gap:2px; }
.mode-btn {
    flex:1; padding:7px 4px; border:none; border-radius:10px; background:transparent;
    color:var(--text-4); font-family:'DM Sans',sans-serif; font-size:12px; font-weight:500;
    cursor:pointer; transition:all .25s; letter-spacing:.3px;
}
.mode-btn.active { background:var(--surface-2); color:var(--text-1); box-shadow:0 1px 4px rgba(0,0,0,0.4); }

/* Display area */
.display-area { display:flex; flex-direction:column; justify-content:flex-end; padding:8px 6px 14px; min-height:120px; position:relative; }
.display-header { display:flex; align-items:center; gap:6px; min-height:18px; margin-bottom:2px; }
.mem-indicator {
    font-size:10px; font-weight:700; color:#ff9f0a; background:rgba(255,159,10,0.15);
    padding:1px 5px; border-radius:4px; display:none;
}
.mem-indicator.visible { display:inline-block; }
.expr-line {
    font-family:'DM Mono',monospace; font-size:13px; color:var(--text-2);
    text-align:right; flex:1; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
}
.main-display-row { display:flex; align-items:center; gap:4px; }
.main-display {
    font-family:'DM Sans',sans-serif; font-size:70px; font-weight:300; color:var(--text-1);
    text-align:right; line-height:1; letter-spacing:-3px; overflow:hidden;
    text-overflow:ellipsis; white-space:nowrap; transition:color .2s,font-size .1s;
    flex:1; cursor:pointer; user-select:none;
}
.main-display.md { font-size:50px; letter-spacing:-2px; }
.main-display.sm { font-size:34px; letter-spacing:-1px; }
.main-display.err { color:#ff5f5f; font-size:26px; font-weight:400; }
.backspace-btn {
    width:32px; height:32px; background:transparent; border:none; color:var(--text-2);
    font-size:18px; cursor:pointer; display:flex; align-items:center; justify-content:center;
    border-radius:8px; transition:all .2s; flex-shrink:0; opacity:0; pointer-events:none;
}
.backspace-btn.visible { opacity:1; pointer-events:all; }
.backspace-btn:hover { background:var(--surface-1); color:var(--text-1); }
.copy-toast {
    position:absolute; bottom:4px; left:50%; transform:translateX(-50%) translateY(10px);
    background:var(--surface-2); color:var(--text-1); padding:4px 14px; border-radius:12px;
    font-size:12px; font-weight:500; opacity:0; transition:all .3s; pointer-events:none;
    backdrop-filter:blur(10px);
}
.copy-toast.show { opacity:1; transform:translateX(-50%) translateY(0); }

/* Angle pills */
.angle-row { display:flex; gap:6px; margin-bottom:6px; padding:0 4px; }
.angle-pill {
    padding:3px 12px; border-radius:20px; font-size:11px; font-weight:600; cursor:pointer;
    transition:all .2s; border:1.5px solid transparent; color:var(--text-2);
    background:transparent; font-family:'DM Sans',sans-serif;
}
.angle-pill.active { background:rgba(10,132,255,0.18); border-color:rgba(10,132,255,0.45); color:#409cff; }

/* ══════ Button Grids ══════ */
.sci-grid,.prog-grid { display:grid; grid-template-columns:repeat(5,1fr); gap:7px; margin-bottom:8px; }
.mem-row { display:grid; grid-template-columns:repeat(4,1fr); gap:7px; margin-bottom:8px; }
.btn-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:10px; }

/* Base button */
.btn {
    position:relative; height:66px; border:none; border-radius:50%;
    font-family:'DM Sans',sans-serif; font-size:20px; font-weight:400; cursor:pointer;
    overflow:hidden; transition:transform .1s,filter .1s,box-shadow .1s;
    display:flex; align-items:center; justify-content:center; outline:none;
    -webkit-tap-highlight-color:transparent; user-select:none;
}
.sci-grid .btn,.prog-grid .btn,.mem-row .btn { height:43px; border-radius:11px; font-size:12px; font-weight:500; }
.btn::after {
    content:''; position:absolute; inset:0; background:rgba(255,255,255,0);
    transition:background .1s; border-radius:inherit;
}
.btn:active::after { background:rgba(255,255,255,0.2); }
.btn:active { transform:scale(.92); filter:brightness(.88); }
.btn:focus-visible { outline:2px solid #409cff; outline-offset:2px; }

/* Number */
.btn-num { background:var(--btn-num-bg); color:var(--btn-num-c); box-shadow:0 2px 8px rgba(0,0,0,0.45); }
.btn-zero { grid-column:span 2; border-radius:33px; justify-content:flex-start; padding-left:26px; }

/* Function (AC, +/-, %) */
.btn-fn { background:var(--btn-fn-bg); color:var(--btn-fn-c); font-size:19px; }

/* Operators */
.btn-op { color:#fff; font-size:24px; font-weight:400; transition:transform .1s,filter .1s,box-shadow .2s; }
.op-div { background:linear-gradient(145deg,#ff9f0a,#ff6200); box-shadow:0 4px 18px rgba(255,98,0,.45); }
.op-mul { background:linear-gradient(145deg,#30d158,#00a844); box-shadow:0 4px 18px rgba(0,168,68,.4); }
.op-sub { background:linear-gradient(145deg,#0a84ff,#005fd4); box-shadow:0 4px 18px rgba(0,95,212,.4); }
.op-add { background:linear-gradient(145deg,#bf5af2,#8800d3); box-shadow:0 4px 18px rgba(136,0,211,.45); }
.op-eq { background:linear-gradient(145deg,#ff375f,#c9002e); box-shadow:0 4px 22px rgba(201,0,46,.55); font-size:26px; }

/* Active operator ring */
.btn-op.op-active { box-shadow:0 0 0 3px #fff, 0 4px 22px rgba(255,255,255,.3); transform:scale(1.08); }

/* Scientific flavors */
.sci-trig { background:linear-gradient(135deg,rgba(255,159,10,.22),rgba(255,98,0,.15)); color:#ffb340; }
.sci-log { background:linear-gradient(135deg,rgba(48,209,88,.2),rgba(0,168,68,.12)); color:#34c759; }
.sci-power { background:linear-gradient(135deg,rgba(10,132,255,.2),rgba(0,95,212,.12)); color:#409cff; }
.sci-const { background:linear-gradient(135deg,rgba(191,90,242,.2),rgba(136,0,211,.12)); color:#da8fff; }
.sci-mem { background:linear-gradient(135deg,rgba(255,55,95,.18),rgba(201,0,46,.1)); color:#ff6b85; }
.sci-misc { background:var(--surface-5); color:var(--text-3); }

/* ══════ Overlays (Help & History) ══════ */
.overlay {
    position:absolute; inset:0; background:var(--overlay-bg);
    backdrop-filter:blur(10px); -webkit-backdrop-filter:blur(10px);
    border-radius:42px; z-index:200; opacity:0; pointer-events:none;
    transition:opacity .3s; display:flex; align-items:flex-end;
}
.overlay.open { opacity:1; pointer-events:all; }
.sheet {
    width:100%; background:var(--sheet-bg); border-radius:24px 24px 0 0;
    padding:12px 20px 44px; transform:translateY(100%);
    transition:transform .42s cubic-bezier(.34,1.1,.64,1);
    max-height:90%; display:flex; flex-direction:column;
}
.overlay.open .sheet { transform:translateY(0); }
.sheet-handle { width:36px; height:4px; background:var(--handle); border-radius:2px; margin:0 auto 14px; }
.sheet-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:14px; padding-bottom:12px; border-bottom:1px solid var(--sep); }
.sheet-title { font-size:17px; font-weight:700; color:var(--text-1); letter-spacing:-0.3px; }
.sheet-header-actions { display:flex; gap:8px; align-items:center; }
.sheet-close {
    width:28px; height:28px; background:var(--surface-3); border:none; border-radius:50%;
    color:var(--text-3); font-size:16px; cursor:pointer; display:flex; align-items:center;
    justify-content:center; transition:background .2s; font-family:'DM Sans',sans-serif;
}
.sheet-close:hover { background:var(--surface-2); }
.clear-btn {
    background:transparent; border:1px solid rgba(255,55,95,0.3); color:#ff375f;
    font-size:11px; font-weight:600; padding:4px 10px; border-radius:8px; cursor:pointer;
    font-family:'DM Sans',sans-serif; transition:all .2s;
}
.clear-btn:hover { background:rgba(255,55,95,0.1); }
.sheet-scroll { overflow-y:auto; flex:1; padding-right:2px; scrollbar-width:thin; scrollbar-color:var(--scrollbar-c) transparent; }
.sheet-scroll::-webkit-scrollbar { width:3px; }
.sheet-scroll::-webkit-scrollbar-thumb { background:var(--scrollbar-c); border-radius:2px; }

/* Help content */
.help-section { margin-bottom:18px; }
.help-section-title { font-size:10.5px; font-weight:600; letter-spacing:1.5px; text-transform:uppercase; color:var(--text-2); margin-bottom:8px; padding:0 2px; }
.help-card { background:var(--surface-4); border-radius:14px; overflow:hidden; }
.help-row { display:flex; align-items:flex-start; gap:12px; padding:11px 13px; border-bottom:1px solid var(--surface-4); }
.help-row:last-child { border-bottom:none; }
.help-icon { width:34px; height:34px; border-radius:9px; display:flex; align-items:center; justify-content:center; font-size:15px; flex-shrink:0; font-weight:600; color:#fff; }
.ic-orange { background:linear-gradient(145deg,#ff9f0a,#ff6200); }
.ic-green { background:linear-gradient(145deg,#30d158,#00a844); }
.ic-blue { background:linear-gradient(145deg,#0a84ff,#005fd4); }
.ic-purple { background:linear-gradient(145deg,#bf5af2,#8800d3); }
.ic-red { background:linear-gradient(145deg,#ff375f,#c9002e); }
.ic-gray { background:var(--surface-3); }
.ic-teal { background:linear-gradient(145deg,#5ac8fa,#0080bc); }
.ic-pink { background:linear-gradient(145deg,#ff6cae,#d80060); }
.ic-indigo { background:linear-gradient(145deg,#5e5ce6,#3634a3); }
.ic-mint { background:linear-gradient(145deg,#63e6be,#20c997); }
.help-text-wrap { flex:1; }
.help-label { font-size:13.5px; font-weight:600; color:var(--text-1); margin-bottom:2px; }
.help-desc { font-size:11.5px; color:var(--text-3); line-height:1.55; }
.help-desc b { color:var(--text-1); }
.tip-badge { display:flex; align-items:center; gap:6px; background:rgba(255,159,10,0.12); border:1px solid rgba(255,159,10,0.22); border-radius:10px; padding:8px 12px; margin-top:8px; font-size:12px; color:#ff9f0a; }

/* History entries */
.history-entry {
    padding:12px 14px; border-bottom:1px solid var(--sep); cursor:pointer; transition:background .2s; border-radius:8px;
}
.history-entry:hover { background:var(--surface-1); }
.history-expr { font-family:'DM Mono',monospace; font-size:12px; color:var(--text-3); margin-bottom:2px; }
.history-result { font-size:20px; font-weight:500; color:var(--text-1); }
.history-empty { text-align:center; color:var(--text-2); font-size:14px; padding:40px 0; }

/* ══════ Responsive ══════ */
@media(max-width:430px) {
    .iphone { width:100vw; border-radius:0; padding:0; box-shadow:none; }
    .iphone::before,.iphone::after { display:none; }
    .screen { border-radius:0; }
    .island { display:none; }
    body::before,body::after { display:none; }
    .overlay { border-radius:0; }
}
@media(max-height:750px) {
    .btn { height:56px; }
    .display-area { min-height:90px; padding:4px 6px 8px; }
    .main-display { font-size:55px; }
}
